#!/usr/bin/env bash

get_sessions() {
    command kak -clear
    command kak -l
}

{
    get_sessions |
    while read session; do
        export session
        pwd=$(krc get %sh[pwd])
        set -- $(krc get %val{client_list})
        for client do
            export client
            bufname=$(krc get %val{bufname})

            # Set fields
            set -- "$session" "$client" "$bufname" "$pwd"

            # Print fields, separated by tabs.
            printf '%s\t' "$@"
            echo
        done
    done
} | column -s $'\t' -t |
    fzf |
    awk '{print "export session=" $1 "; export client=" $2}'


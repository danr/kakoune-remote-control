#!/usr/bin/env bash

get_sessions() {
    command kak -clear
    command kak -l
}

{
    get_sessions |
    while read session; do
        export session
        pwd=$(krc get %sh[pwd])
        eval "set -- $(krc get -quoting shell %val[client_list])"
        for client; do
            export client
            echo -ne "$session" "\t"
            echo -ne "$client" "\t"
            echo -ne "$(krc get %val[bufname])" "\t"
            echo -ne "$pwd" "\t"
            echo
        done
    done
} | column -s $'\t' -t |
    fzf |
    awk '{print "export session=" $1 "; export client=" $2}'

